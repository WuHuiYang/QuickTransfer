# 快传（QuickTransfer）- 产品需求文档（PRD）

**版本**：v1.0
**日期**：2025-02-07
**产品类型**：文件传输工具
**技术栈**：FastAPI + Vue 3

---

## 📋 目录

1. [产品概述](#1-产品概述)
2. [核心功能](#2-核心功能)
3. [用户故事](#3-用户故事)
4. [功能需求详情](#4-功能需求详情)
5. [非功能需求](#5-非功能需求)
6. [技术架构](#6-技术架构)
7. [数据设计](#7-数据设计)
8. [接口设计](#8-接口设计)
9. [部署方案](#9-部署方案)

---

## 1. 产品概述

### 1.1 产品定位

> **"快传"** - 一个浏览器即用、无文件大小限制、跨设备文件传输工具

### 1.2 核心价值主张

| 优势 | 说明 |
|------|------|
| **浏览器即用** | 不需要安装 App，打开网页就能用 |
| **无大小限制** | 可以传输 10GB 的大文件 |
| **全格式支持** | 支持所有文件类型 |
| **永久保存** | 文件不会自动删除 |
| **跨设备** | 手机、电脑、平板都能用 |

### 1.3 目标用户

- **主要用户**：学生、上班族、自由职业者
- **使用场景**：传输学习资料、设计稿、视频、照片等

### 1.4 与竞品对比

| 功能 | 微信传输助手 | 百度网盘 | 快传 |
|------|-------------|---------|------|
| 需要安装 App | ❌ | ❌ | ✅ |
| 文件大小限制 | ❌ 100MB | ❌ | ✅ |
| 文件类型限制 | ⚠️ 部分 | ❌ | ✅ |
| 永久保存 | ❌ 7天删除 | ✅ | ✅ |
| 在线预览 | ⚠️ 仅图片 | ⚠️ 部分 | ✅ |
| 历史记录 | ❌ | ✅ | ✅ |

---

## 2. 核心功能

### 2.1 必须实现的功能（P0）

#### 功能 1：用户登录

**描述**：
- 用户通过邮箱 + 验证码登录
- 30 天内免登录
- 同一个邮箱在手机和电脑登录，看到相同的文件

**流程**：
```
1. 用户输入邮箱
2. 系统发送 6 位验证码
3. 用户输入验证码
4. 登录成功
5. 30 天内再次访问自动登录
```

---

#### 功能 2：文件上传

**描述**：
- 支持单个文件上传
- 支持多文件同时上传
- 拖拽上传
- 实时显示上传进度
- 文件大小限制：单文件 10GB，总存储 10GB

**支持的文件类型**：
- 文档：PDF、Word、Excel、PPT、TXT 等
- 图片：JPG、PNG、GIF、WebP 等
- 视频：MP4、MOV、AVI 等
- 音频：MP3、WAV 等
- 压缩包：ZIP、RAR 等
- 其他：所有文件类型

---

#### 功能 3：文件下载

**描述**：
- 单个文件下载
- 批量下载（打包成 ZIP）
- 实时显示下载进度

---

#### 功能 4：文件管理

**描述**：
- 文件列表展示
  - 网格视图（缩略图）
  - 列表视图（详细信息）
- 文件夹管理
  - 创建文件夹
  - 移动文件到文件夹
- 文件删除
  - 单个删除
  - 批量删除

---

#### 功能 5：在线预览

**描述**：
- 图片在线查看
- PDF 在线阅读
- Office 文档在线预览
- 视频在线播放
- 音频在线播放
- 文本文件查看

---

### 2.2 重要功能（P1）

#### 功能 6：文件搜索

**描述**：
- 按文件名搜索
- 支持模糊搜索
- 实时显示搜索结果

---

#### 功能 7：存储空间管理

**描述**：
- 显示已用空间
- 显示剩余空间
- 空间使用率可视化

---

#### 功能 8：文件分享（可选）

**描述**：
- 生成分享链接
- 设置访问码保护
- 设置链接有效期（1天/7天/30天）

---

## 3. 用户故事

### 故事 1：学生传输学习资料

**角色**：大学生小王

**场景**：
```
小王在手机上看到一篇很好的学习 PDF
想传到电脑上仔细阅读

他打开 quicktransfer.com（手机）
→ 输入邮箱，收到验证码
→ 上传 PDF 文件
→ 关闭网站

回到宿舍，小王打开电脑
→ 访问 quicktransfer.com（电脑）
→ 输入同一个邮箱，登录
→ 看到刚才上传的 PDF
→ 在线阅读或下载
```

**价值**：
- 无需安装 App
- 不限文件大小
- 随时访问

---

### 故事 2：设计师传输大文件

**角色**：设计师小李

**场景**：
```
小李设计完一个 2GB 的设计稿
需要发给客户审核

他打开 quicktransfer.com
→ 上传设计稿（2GB，微信传不了）
→ 生成分享链接
→ 把链接发给客户
→ 客户下载查看
```

**价值**：
- 无大小限制
- 传输速度快
- 文件永久保存

---

### 故事 3：摄影师传照片到电脑

**角色**：摄影师小张

**场景**：
```
小张用相机拍了 100 张 RAW 格式照片
总共 5GB
需要传到电脑上修图

他打开 quicktransfer.com
→ 选择所有照片上传
→ 自动上传（后台运行）
→ 回家后电脑打开网站
→ 批量下载所有照片
```

**价值**：
- 批量操作
- 后台上传
- 不占手机存储

---

## 4. 功能需求详情

### 4.1 用户系统

#### 4.1.1 注册/登录

**功能规格**：

| 字段 | 说明 | 必填 |
|------|------|------|
| 邮箱 | 用户账号 | ✅ |
| 验证码 | 6 位数字 | ✅ |

**流程**：
```
输入邮箱 → 发送验证码 → 验证码登录 → 30天免登录
```

**存储空间限制**：
- 免费用户：10GB 总存储
- 单文件限制：10GB

---

#### 4.1.2 配额管理

**功能**：
- 显示已用空间
- 显示剩余空间
- 使用率可视化

**规则**：
- 超过 80% 显示警告
- 超过 95% 拒绝上传

---

### 4.2 文件上传

#### 4.2.1 上传方式

**方式 1：点击上传**
```
[选择文件] 按钮
→ 打开文件选择器
→ 选择一个或多个文件
→ 开始上传
```

**方式 2：拖拽上传**
```
拖拽文件到上传区域
→ 自动开始上传
```

---

#### 4.2.2 上传限制

| 限制项 | 限制值 | 说明 |
|--------|--------|------|
| 单文件大小 | 10GB | 超过拒绝 |
| 总存储空间 | 10GB | 超过拒绝 |
| 文件类型 | 所有类型 | 无限制 |
| 并发上传 | 最多 5 个 | 同时最多上传 5 个文件 |

---

#### 4.2.3 上传进度

**显示信息**：
- 文件名
- 上传进度（百分比）
- 上传速度（MB/s）
- 剩余时间（估算）

---

### 4.3 文件下载

#### 4.3.1 下载方式

**单个下载**：
```
点击下载按钮 → 开始下载
```

**批量下载**：
```
选择多个文件 → 点击"批量下载"
→ 打包成 ZIP → 下载 ZIP
```

---

#### 4.3.2 下载限制

| 限制项 | 限制值 |
|--------|--------|
| 并发下载 | 最多 3 个 |
| 单次打包下载 | 文件总数 < 100 |

---

### 4.4 文件管理

#### 4.4.1 文件夹管理

**创建文件夹**：
```
输入文件夹名称
→ 创建成功
```

**移动文件**：
```
选择文件 → 选择目标文件夹 → 移动
```

**删除文件夹**：
```
选择文件夹 → 删除文件夹及其内容
```

---

#### 4.4.2 文件操作

**重命名**：
```
右键文件 → 重命名 → 输入新名称
```

**删除**：
```
单个删除：点击删除按钮 → 确认删除
批量删除：多选 → 批量删除 → 确认删除
```

---

### 4.5 在线预览

#### 4.5.1 支持的文件类型

| 文件类型 | 预览方式 | 技术方案 |
|---------|---------|---------|
| 图片 | 在线查看 | 直接显示 |
| PDF | 在线阅读 | PDF.js |
| Word/Excel/PPT | 在线查看 | Only Office |
| 视频 | 播放 | Video.js |
| 音频 | 播放 | Howler.js |
| 文本 | 查看 | 直接显示 |
| 代码 | 查看 | Prism.js 高亮 |

---

## 5. 非功能需求

### 5.1 性能要求

| 指标 | 要求 |
|------|------|
| **响应时间** | 页面加载 < 2 秒 |
| **上传速度** | 支持 10MB/s（受用户网速影响） |
| **并发用户** | 支持 100 个并发用户 |
| **文件数量** | 单用户最多 1000 个文件 |

---

### 5.2 安全性

#### 5.2.1 文件安全

- 文件名清洗（防止路径穿越攻击）
- 文件类型验证
- 单文件大小限制
- 总存储空间限制

---

#### 5.2.2 访问安全

- 邮箱验证码登录
- 30 天免登录 Token
- HTTPS 加密传输

---

#### 5.2.3 数据安全

- 定期备份
- 敏感数据不存储

---

### 5.3 可用性

| 指标 | 要求 |
|------|------|
| **可用性** | 99.5% |
| **故障恢复** | 1 小时内 |

---

## 6. 技术架构

### 6.1 技术栈

#### 后端
- **框架**：FastAPI 0.115.0
- **Python**：3.10+
- **数据库**：SQLite（开发）/ PostgreSQL（生产可选）
- **异步**：async/await

#### 前端
- **框架**：Vue 3
- **构建工具**：Vite
- **UI 库**：Tailwind CSS 或 Element Plus
- **状态管理**：Pinia

#### 部署
- **服务器**：腾讯云轻量应用服务器 4核4G
- **操作系统**：Ubuntu 20.04 + Docker
- **反向代理**：Nginx
- **容器化**：Docker + Docker Compose

---

### 6.2 系统架构图

```
┌──────────────────────────────────────────┐
│              用户（手机/电脑）               │
└──────────────────────────────────────────┘
                    ↓
┌──────────────────────────────────────────┐
│              Nginx (HTTPS)              │
│         ┌────────────────────────────┐    │
│         │    静态文件 (Vue 前端)     │    │
│         └────────────────────────────┘    │
└──────────────────────────────────────────┘
                    ↓
┌──────────────────────────────────────────┐
│         FastAPI 后端 (Docker 容器)      │
│  ┌────────────────────────────────────┐  │
│  │  用户认证 (邮箱+验证码)           │  │
│  │  文件上传/下载                   │  │
│  │  文件管理                         │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
                    ↓
┌──────────────────────────────────────────┐
│         SQLite 数据库 (Docker 卷)       │
│  ┌────────────────────────────────┐     │
│  │  用户表                         │     │
│  │  文件表                         │     │
│  │  文件夹表                       │     │
│  └────────────────────────────────┘     │
└──────────────────────────────────────────┘
                    ↓
┌──────────────────────────────────────────┐
│       本地存储 (/data/uploads)          │
│  ┌────────────────────────────────┐    │
│  │  上传的文件（实际文件）         │    │
│  └────────────────────────────────┘    │
└──────────────────────────────────────────┘
```

---

## 7. 数据设计

### 7.1 数据库表设计

#### 表 1：users（用户表）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY |
| email | String(255) | 邮箱（账号） | UNIQUE, NOT NULL |
| created_at | DateTime | 注册时间 | DEFAULT NOW() |
| last_login | DateTime | 最后登录时间 | |
| storage_used | BigInteger | 已用空间（字节） | DEFAULT 0 |
| storage_limit | BigInteger | 存储限制（字节） | DEFAULT 10737418240 (10GB) |

---

#### 表 2：files（文件表）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY |
| user_id | Integer | 所属用户 | FOREIGN KEY → users.id |
| filename | String(255) | 原始文件名 | NOT NULL |
| stored_name | String(255) | 存储文件名（UUID） | UNIQUE, NOT NULL |
| file_path | String(500) | 文件存储路径 | NOT NULL |
| file_size | BigInteger | 文件大小（字节） | NOT NULL |
| mime_type | String(100) | MIME 类型 | NOT NULL |
| folder_id | Integer | 所属文件夹 | FOREIGN KEY → folders.id |
| upload_time | DateTime | 上传时间 | DEFAULT NOW() |
| download_count | Integer | 下载次数 | DEFAULT 0 |
| is_deleted | Boolean | 是否删除 | DEFAULT False |

---

#### 表 3：folders（文件夹表）

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY |
| user_id | Integer | 所属用户 | FOREIGN KEY → users.id |
| name | String(100) | 文件夹名称 | NOT NULL |
| parent_id | Integer | 父文件夹 | FOREIGN KEY → folders.id |
| created_at | DateTime | 创建时间 | DEFAULT NOW() |

---

### 7.2 文件存储结构

```
/data/uploads/
├── {user_id}/
│   ├── {file_id}_{filename}
│   └── ...
```

**示例**：
```
/data/uploads/
├── 1/
│   ├── abc123_resume.pdf
│   ├── def456_photo.jpg
│   └── 789012_design.psd
└── 2/
    ├── xyz789_document.docx
    └── ...
```

---

## 8. 接口设计

### 8.1 用户认证接口

#### POST /api/auth/send-code
**描述**：发送验证码

**请求**：
```json
{
  "email": "user@example.com"
}
```

**响应**：
```json
{
  "message": "验证码已发送"
}
```

---

#### POST /api/auth/verify-code
**描述**：验证码登录

**请求**：
```json
{
  "email": "user@example.com",
  "code": "123456"
}
```

**响应**：
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 2592000  // 30天
}
```

---

### 8.2 文件上传接口

#### POST /api/files/upload
**描述**：上传文件

**请求**：multipart/form-data
```
file: (二进制文件)
folder_id: 1 (可选)
```

**响应**：
```json
{
  "id": 123,
  "filename": "resume.pdf",
  "file_size": 2097152,
  "upload_time": "2025-02-07T10:30:00Z"
}
```

---

### 8.3 文件列表接口

#### GET /api/files
**描述**：获取文件列表

**查询参数**：
- `folder_id`: 文件夹 ID（可选）
- `page`: 页码（默认 1）
- `page_size`: 每页数量（默认 20）
- `search`: 搜索关键词（可选）

**响应**：
```json
{
  "files": [
    {
      "id": 123,
      "filename": "resume.pdf",
      "file_size": 2097152,
      "upload_time": "2025-02-07T10:30:00Z",
      "folder_id": 1
    }
  ],
  "total": 1,
  "page": 1,
  "page_size": 20
}
```

---

### 8.4 文件下载接口

#### GET /api/files/{file_id}/download
**描述**：下载文件

**响应**：二进制文件流

---

### 8.5 文件管理接口

#### DELETE /api/files/{file_id}
**描述**：删除文件

**响应**：
```json
{
  "message": "文件已删除"
}
```

---

## 9. 部署方案

### 9.1 服务器配置

**腾讯云轻量应用服务器**：
- CPU：4 核
- 内存：4GB
- 带宽：3Mbps
- 硬盘：40GB
- 系统：Ubuntu 20.04 + Docker CE 27.5.1
- 价格：79 元/年

---

### 9.2 部署步骤

#### 第 1 步：购买服务器
```
1. 登录腾讯云控制台
2. 轻量应用服务器 → 创建实例
3. 选择地域：上海
4. 套餐：4核4G 3Mbps
5. 镜像：Docker CE 27.5.1
6. 购买
```

#### 第 2 步：连接服务器
```bash
ssh root@服务器IP
# 输入密码
```

#### 第 3 步：安装 Docker Compose
```bash
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

#### 第 4 步：上传代码
```bash
# 在本地（项目目录）
scp -r . root@服务器IP:/root/quicktransfer/
```

#### 第 5 步：启动服务
```bash
# 在服务器上
cd /root/quicktransfer
docker-compose up -d
```

#### 第 6 步：配置 Nginx
```bash
# 安装 Nginx
apt install nginx

# 配置反向代理
vim /etc/nginx/sites-available/quicktransfer
```

#### 第 7 步：配置域名（可选）
```
1. 购买域名
2. DNS 解析
3. 配置 SSL 证书（Let's Encrypt）
```

---

### 9.3 开机自启动

**配置 Docker Compose 自动启动**：
```yaml
services:
  backend:
    restart: always
  frontend:
    restart: always
```

---

## 10. 开发计划

### 10.1 开发阶段

#### 第 1 阶段：后端开发（2-3 天）
- 用户认证（邮箱验证码）
- 文件上传
- 文件下载
- 文件管理

#### 第 2 阶段：前端开发（2-3 天）
- 登录页面
- 文件上传页面
- 文件列表页面
- 文件预览功能

#### 第 3 阶段：联调测试（1 天）
- 接口联调
- 功能测试
- Bug 修复

#### 第 4 阶段：部署上线（0.5-1 天）
- 服务器配置
- Docker 部署
- 域名配置

---

### 10.2 技术债务

**未来可以优化**：
- 文件分片上传（超大文件）
- 断点续传
- WebSocket 实时通知
- 文件加密存储
- CDN 加速

---

## 11. 附录

### 11.1 参考文档
- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [Vue 3 官方文档](https://vuejs.org/)
- [SQLAlchemy 文档](https://docs.sqlalchemy.org/)

### 11.2 项目文件结构

```
quicktransfer/
├── backend/                    # 后端项目
│   ├── app/
│   │   ├── api/              # API 路由
│   │   ├── models/           # 数据库模型
│   │   ├── schemas/          # Pydantic 模型
│   │   ├── services/         # 业务逻辑
│   │   └── core/             # 核心配置
│   ├── main.py
│   ├── requirements.txt
│   └── Dockerfile
│
├── frontend/                   # 前端项目
│   ├── src/
│   │   ├── components/       # 组件
│   │   ├── views/            # 页面
│   │   ├── api/              # API 调用
│   │   ├── stores/           # Pinia 状态
│   │   └── router/           # 路由
│   ├── package.json
│   └── vite.config.js
│
├── docker-compose.yml         # Docker 配置
└── README.md                  # 项目说明
```

---

**文档版本**：v1.0
**最后更新**：2025-02-07
**状态**：待审核

---

## 变更日志

### v1.0 (2025-02-07)
- 初始版本
- 定义核心功能
- 确定技术栈
- 规划开发计划